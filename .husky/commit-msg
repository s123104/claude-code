#!/bin/sh
. "$(dirname "$0")/_/husky.sh"

# Claude Code æ–‡æª”å°ˆæ¡ˆ Commit-msg Hook
# é©—è­‰ Conventional Commits æ ¼å¼

echo "ğŸ“‹ é©—è­‰ Commit è¨Šæ¯æ ¼å¼..."

commit_msg=$(cat "$1")

# Conventional Commits æ­£å‰‡è¡¨é”å¼
pattern="^(feat|fix|docs|style|refactor|perf|test|build|ci|chore|revert)(\(.+\))?: .{1,100}$"

# å…è¨± merge commit
if echo "$commit_msg" | grep -qE "^Merge"; then
    echo "âœ… Merge commit å·²æ¥å—"
    exit 0
fi

# é©—è­‰æ ¼å¼
if echo "$commit_msg" | head -1 | grep -qE "$pattern"; then
    echo "âœ… Commit è¨Šæ¯æ ¼å¼æ­£ç¢º"
    exit 0
else
    echo "âŒ Commit è¨Šæ¯ä¸ç¬¦åˆ Conventional Commits æ ¼å¼"
    echo ""
    echo "æ ¼å¼è¦æ±‚: <type>(<scope>): <description>"
    echo ""
    echo "æœ‰æ•ˆçš„ type:"
    echo "  feat     - æ–°åŠŸèƒ½"
    echo "  fix      - éŒ¯èª¤ä¿®å¾©"
    echo "  docs     - æ–‡æª”æ›´æ–°"
    echo "  style    - æ ¼å¼èª¿æ•´"
    echo "  refactor - é‡æ§‹"
    echo "  perf     - æ•ˆèƒ½æ”¹å–„"
    echo "  test     - æ¸¬è©¦ç›¸é—œ"
    echo "  build    - å»ºæ§‹ç›¸é—œ"
    echo "  ci       - CI/CD ç›¸é—œ"
    echo "  chore    - å…¶ä»–ç¶­è­·"
    echo ""
    echo "ç¯„ä¾‹:"
    echo "  docs: æ›´æ–° agents æ–‡æª”è‡³ v3.0.0"
    echo "  fix(scripts): ä¿®å¾©ç‰ˆæœ¬åŒæ­¥è…³æœ¬"
    echo "  feat: æ–°å¢è‡ªå‹•åŒ–ç¶­è­·è…³æœ¬"
    echo ""
    exit 1
fi
